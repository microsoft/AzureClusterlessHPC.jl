<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Credentials - AzureClusterlessHPC</title>
  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Credentials";
    var mkdocs_page_input_path = "credentials.md";
    var mkdocs_page_url = "/AzureClusterlessHPC.jl/credentials/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> AzureClusterlessHPC</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../installation/">Installation</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../quickstart/">Quickstart</a>
	    </li>
          
            <li class="toctree-l1 current">
		
    <a class="current" href="./">Credentials</a>
    <ul class="subnav">
            
    <li class="toctree-l2"><a href="#parameters-and-credentials">Parameters and credentials</a></li>
    
        <ul>
        
            <li><a class="toctree-l3" href="#single-batch-and-storage-account">Single batch and storage account</a></li>
        
            <li><a class="toctree-l3" href="#job-monitoring-via-app-insights">Job monitoring via App Insights</a></li>
        
            <li><a class="toctree-l3" href="#multi-accounts">Multi accounts</a></li>
        
            <li><a class="toctree-l3" href="#user-parameters">User parameters</a></li>
        
        </ul>
    

    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../pool/">Manage pools</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../functioncalls/">Remote function calls</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../broadcasting/">Broadcasting</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../output/">Collect output</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../files/">Copying and retrieving files</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../cleanup/">Clean up</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../faq/">FAQ</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../about/">About</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">AzureClusterlessHPC</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Credentials</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/microsoft/AzureClusterlessHPC.jl/edit/master/docs/credentials.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="parameters-and-credentials">Parameters and credentials</h1>
<h2 id="single-batch-and-storage-account">Single batch and storage account</h2>
<p><code>AzureClusterlessHPC.jl</code> requires at the minimum <strong>one Azure Batch</strong> account and <strong>one Azure Storage</strong> account. The storage account is authenticated via a secret key, whereas Azure Batch must be authenticated using the Azure Active Directory (AAD). The <code>setup.sh</code> script in the root directory automatically creates the accounts and creates a <code>credentials.json</code> file. </p>
<p>Alternatively, you can set up the accounts manually (e.g. using the Azure console). Refer to the <a href="https://docs.microsoft.com/en-us/azure/batch/batch-aad-auth">Azure documentation</a> for information on how to authenticate Azure Batch via the AAD. Once you have created the accounts, create a credential file with the storage key and batch AAD authentication. Use the following template for the <code>credentials.json</code> file: </p>
<pre><code>{
    &quot;_AD_TENANT&quot;: &quot;xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx&quot;,

    &quot;_AD_BATCH_CLIENT_ID&quot;: &quot;xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx&quot;,
    &quot;_AD_SECRET_BATCH&quot;: &quot;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;,
    &quot;_BATCH_ACCOUNT_URL&quot;: &quot;https://batchaccountname.batchregion.batch.azure.com&quot;,
    &quot;_BATCH_RESOURCE&quot;: &quot;https://batch.core.windows.net/&quot;,

    &quot;_STORAGE_ACCOUNT_NAME&quot;: &quot;storageaccountname&quot;,
    &quot;_STORAGE_ACCOUNT_KEY&quot;: &quot;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;
}
</code></pre>

<p>When using AzureClusterlessHPC, set the environment variable <code>ENV["CREDENTIALS"] = "/path/to/credentials.json"</code> <strong>before</strong> you load the package via <code>using AzureClusterlessHPC</code>.</p>
<h2 id="job-monitoring-via-app-insights">Job monitoring via App Insights</h2>
<p><code>AzureClusterlessHPC.jl</code> supports job monitoring via Azure Batch Insights. Follow <a href="https://github.com/Azure/batch-insights">the Batch Insights instructions</a> to set up Applications insights in the Azure portal. From your application, retrieve the app insights ID and the instrumentation key and add them to your <code>credentials.json</code> file: </p>
<pre><code>{
    &quot;_APP_INSIGHTS_APP_ID&quot;: &quot;xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx&quot;,
    &quot;_APP_INSIGHTS_INSTRUMENTATION_KEY&quot;: &quot;xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx&quot;
}
</code></pre>

<h2 id="multi-accounts">Multi accounts</h2>
<p>AzureClusterlessHPC also allows using multiple storage and/or batch accounts. Using multiple batch accounts provides the possiblity to cirumvent service limits of a single batch account or it allows to distribute workloads among multiple regions. If you create batch accounts for multiple regions, you need to have at least one storage account in each region. To automatically create multiple batch and storage accounts, use the shell script <code>create_azure_accounts.sh</code>. Pass the list of region(s) and the number of accounts per region as command line arguments to the script. E.g., to create two batch and storeage acounts in each US West and South Central US (i.e, total of 4 batch and 4 storage accounts), run:</p>
<pre><code># Go to AzureClusterlessHPC directory
cd /path/to/AzureClusterlessHPC

# Azure CLI log in
az login

# Create accounts
./create_azure_accounts &quot;westus southcentralus&quot; 2
</code></pre>

<p>Creating the accounts may take several minutes, depending on how many accounts are being created. The script also fetches the required credentials and stores them in the directory <code>user_data</code>. No further actions from the user side are required. To use the credentials stored in <code>user_data</code> with AzureClusterlessHPC, make sure that the environment variable <code>"CREDENTIALS"</code> is unset (run <code>unset CREDENTIALS</code> from the bash command line). If <code>CREDENTIALS</code> is not set, AzureClusterlessHPC will automatically look for credentials in <code>user_data</code>. </p>
<p>After loading AzureClusterlessHPC in Julia (<code>using AzureClusterlessHPC</code>), you can check which accounts were found by checking <code>AzureClusterlessHPC.__credentials__</code>. This returns a list with one entry per available batch account. Type <code>AzureClusterlessHPC.__credentials__[i]</code> to print the credential information for the <code>i-th</code> account.</p>
<h2 id="user-parameters">User parameters</h2>
<p>Users can optionally provide a <code>parameters.json</code> file that specifies pool and job parameters. Set the environment variable <code>ENV["PARAMETERS"]=/path/to/parameters.json</code> <strong>before</strong> loading the package (see section "Quickstart" for an example).</p>
<p>The following set of parameters and default values are used, unless specified otherwise by the user:</p>
<pre><code>{    
    &quot;_POOL_ID&quot;: &quot;BatchPool&quot;,
    &quot;_POOL_COUNT&quot;: &quot;1&quot;,
    &quot;_NODE_COUNT_PER_POOL&quot;: &quot;1&quot;,
    &quot;_POOL_VM_SIZE&quot;: &quot;Standard_E2s_v3&quot;,
    &quot;_JOB_ID&quot;: &quot;BatchJob&quot;,
    &quot;_STANDARD_OUT_FILE_NAME&quot;: &quot;stdout.txt&quot;,
    &quot;_NODE_OS_PUBLISHER&quot;: &quot;Canonical&quot;,
    &quot;_NODE_OS_OFFER&quot;: &quot;UbuntuServer&quot;,
    &quot;_NODE_OS_SKU&quot;: &quot;18.04&quot;,
    &quot;_BLOB_CONTAINER&quot;: &quot;redwoodtemp&quot;,
    &quot;_INTER_NODE_CONNECTION&quot;: &quot;0&quot;,
    &quot;_NUM_RETRYS&quot;: &quot;0&quot;,
    &quot;_MPI_RUN&quot;: &quot;0&quot;,
    &quot;_CONTAINER&quot;: &quot;None&quot;,
    &quot;_NUM_NODES_PER_TASK&quot;: &quot;1&quot;,
    &quot;_NUM_PROCS_PER_NODE&quot;: &quot;1&quot;,
    &quot;_OMP_NUM_THREADS&quot;: &quot;1&quot;,
    &quot;_JULIA_DEPOT_PATH&quot;: &quot;/mnt/batch/tasks/startup/wd/.julia&quot;,
    &quot;_PYTHONPATH&quot;: &quot;/mnt/batch/tasks/startup/wd/.local/lib/python3.6/site-packages&quot;
}
</code></pre>

<p><strong>Note:</strong> Do not modify the <code>"_JULIA_DEPOT_PATH"</code> and <code>"_PYTHONPATH"</code> unless you use a pool with a custom image or Docker container in which Julia has been already installed. In that case, set the depot path to the location of the <code>.julia</code> directory.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../pool/" class="btn btn-neutral float-right" title="Manage pools">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../quickstart/" class="btn btn-neutral" title="Quickstart"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright (c) Microsoft Corporation. All rights reserved.</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/microsoft/AzureClusterlessHPC.jl/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../quickstart/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../pool/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
